\documentclass[a4paper,british]{article}

% ======== General set-up

\usepackage[british]{babel} % avoids `anal-ysis', inter alia.
\usepackage[hmargin=3.5cm,vmargin=2.5cm]{geometry}
\frenchspacing
\usepackage{ifpdf} % For now, I'm just targeting pdflatex and htlatex.
\usepackage{calc} % allow infix arithmetic
\ifpdf
  \usepackage[T1]{fontenc}
  \usepackage[bitstream-charter]{mathdesign}
  \renewcommand{\sfdefault}{fvs}
\fi
\usepackage[round]{natbib}
\usepackage[utf8]{inputenc}
\usepackage{url}
\usepackage{graphicx}
%\usepackage{multirow}
\usepackage{placeins}
\usepackage{booktabs}
\usepackage{listings}
\usepackage{textcase}
\usepackage{textcomp} % for \textdegree
\ifpdf
  \usepackage[unicode=true]{hyperref}
  \hypersetup{breaklinks=true, pdfborder={0 0 0}}
\fi
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setlength{\belowcaptionskip}{1ex}

% ======== My commands

% Custom definition list for menu items
\newcommand{\menuitemlabel}[1]{%
\mbox{\textsf{#1}}\hfil}
\newenvironment{menuitemlist}%
{\begin{list}{}{%
\renewcommand{\makelabel}{\menuitemlabel}%
\setlength{\labelwidth}{35pt}%
\setlength{\leftmargin}%
             {\labelwidth+\labelsep}}}%
{\end{list}}

\newcommand{\ppcmd}[1]{\textsf{#1}} % For `computer' text
% \newcommand{\caps}[1]{\textsc{#1}} % for acronyms and initialisms
\newcommand{\caps}[1]{\MakeTextUppercase{#1}} % for acronyms and initialisms
\newcommand{\submenu}{ \textgreater{} } % htlatex doesn't like `>'.
\newcommand{\alnifi}{$\alpha_{95}$}
\newcommand{\quot}[1]{`#1'}

% ======== Title

% automatic version number / date: see
% http://truongnotes.tumblr.com/post/13407676428/embed-mercurials-version-number-in-latex

\input hg.id
\title{PuffinPlot User Manual}
\author{Pontus Lurcock}
\date{\HgDate}

% ======== Document starts here.

\begin{document}

\maketitle

\section{Introduction}

This manual gives a practical guide to the usage of the PuffinPlot
palaeomagnetic data analysis program. Note that it does not elucidate the
principles of the analysis techniques themselves, and a working knowledge of
palaeomagnetic procedures is assumed. For excellent introductions to
palaeomagnetic analysis, see \cite{tauxe2010paleomagnetism} or
\cite{butler1992paleomagnetism}.

\section{Installation}

This section describes the hardware and software requirements for
running PuffinPlot, and gives instructions for installing and running
it.

\subsection{Requirements}

PuffinPlot runs on the Java platform (version 5 or later), which is
preinstalled or freely available for a variety of operating systems,
including Windows, Linux, and Mac OS X. Java is generally easy to install,
but in-depth instructions for installing it are beyond the scope of this
manual; please consult the documentation for your operating system or visit
\url{http://www.java.com/} for details.

\paragraph{Java installation: Mac OS X notes.} On most versions of Mac OS X,
Java is preinstalled as standard. On version 10.7 (Lion) it must be manually
installed via \ppcmd{Applications\submenu Utilities\submenu Java
  Preferences}.

\subsection{Obtaining and installing PuffinPlot}

PuffinPlot is distributed in two variants. The first is suitable for all
operating systems. The second has identical functionality, but is
tailored for easier installation and use on Mac OS X. Mac users are
advised to use the second variant, although the first will also work for
them.

\subsubsection{All operating systems}

The latest cross-platform version of PuffinPlot may be downloaded as a file
named \textsf{PuffinPlot.jar} from
\url{http://talvi.net/PuffinPlot.jar}. This file is recommended for
Linux, Windows, and other non-Mac operating systems.

The details of starting PuffinPlot vary between operating systems, but
double-clicking on the file \textsf{PuffinPlot.jar} is the most common
method. In some cases it may be necessary to right-click on the file and
select \emph{Open with Java runtime} or some similar text from a menu.
PuffinPlot can also be started from a terminal prompt by setting the
current folder to the one containing PuffinPlot, and typing
\textsf{java -jar PuffinPlot.jar}.

\paragraph{Note for Windows users.} Under Windows, other programs may
occasionally interfere with the Java platform; if you have the Java platform
installed on Windows but are still unable to run \ppcmd{jar} files such as
\ppcmd{PuffinPlot.jar}, the situation can usually be fixed by running the
\ppcmd{jarfix} program. At the time of writing, \ppcmd{jarfix} may be
downloaded from \url{http://johann.loefflmann.net/en/software/jarfix/}.

\subsubsection{Mac OS X}

The latest Mac OS X version of PuffinPlot may be downloaded as a file
named \textsf{PuffinPlot.zip} from
\url{http://talvi.net/PuffinPlot.zip}. This file is packaged as a
standard OS X application and conforms more nearly to OS X user
interface standards than the cross-platform version described in the
previous section.

After downloading \textsf{PuffinPlot.zip}, double-click on it to
automatically extract the PuffinPlot application, denoted by an icon
representing a puffin (specifically, the Atlantic Puffin
\emph{Fratercula arctica}). The application may then be dragged into the
Applications folder, or any other convenient place.

PuffinPlot is started by double-clicking on its application icon.

\section{Basic usage}

This section gives a brief introduction to the PuffinPlot data model and
to the features of its main window.

\subsection{A note on keyboard shortcuts}

PuffinPlot provides a large number of keyboard shortcuts for its various
capabilities; most of them involve holding down the Ctrl key while
pressing another key. On Mac OS X, these shortcuts use the command key
rather than the Ctrl key, in accordance with Apple user interface
guidelines. Throughout this manual, keyboard shortcuts will be given as
(for example) Ctrl-A. Users of Mac OS X should read these shortcuts as
command-A, etc.

\subsection{Opening a file}

To open a file, select \textsf{Open\ldots} from the \textsf{File} menu. This
will allow you to choose one or more files to open from a standard file
selection window. You may also select an entire folder; in this case
every file within the folder will be opened.

\begin{figure}[htbp]
\centering
\ifpdf\includegraphics{figures/annot-scrnshot.pdf}
\else\includegraphics{figures/annot-scrnshot.png}
\fi
\caption{\label{fig:screenshot}The main window of PuffinPlot with a discrete file loaded,
showing the default data plot layout. Data plots, information displays,
and controls are annotated. Note that several other data plots are
available, but are not shown by default, and that the layout may be
freely rearranged by the user. Data points above the 275\textdegree C
demagnetization step have been hidden.}
\end{figure}

\subsection{A tour of the main window}

Figure 1 shows an annotated screenshot of PuffinPlot's main window with
a discrete sample data file open. The bulk of the window is devoted to
the data display itself, and shows the four most popular data display
methods for palaeomagnetic data: a table, a Zijderveld plot, an
equal-area projection, and a demagnetization-intensity biplot (which
also shows an overlaid magnetic susceptibility plot). The plots are
interactive, in that individual data points may be selected by clicking
or by dragging a rectangle with the mouse.

To the left of the main plot display area is the sample chooser, which shows
a complete list of the samples within the suite, with the currently selected
sample highlighted. Multiple samples may be selected at once allowing
functions such as \caps{pca} calculation to be performed \emph{en masse}. If
a long core data file is loaded, the sample chooser is shown as a vertical
slider indicating depth rather than a list of sample names.

Above the main plot area is the toolbar, which gives convenient access
to some of the most frequently used facilities of the program. From left
to right, these are: choosers for the currently displayed data suite,
the orientation correction, and the Zijderveld projection type; displays
of the sample and formation orientations and magnetic declination; and
buttons for three of the most commonly performed actions.

At the top of the window is the menu bar, providing access to all the
program's functions in a hierarchical manner. On Mac OS, the menu bar is
at the top of the screen rather than the top of the window, and includes
an extra menu at the left, entitled \textsf{PuffinPlot}.

\subsection{Data model}

\begin{figure}[htbp]
\centering
\ifpdf\includegraphics{figures/data-model.pdf}
\else\includegraphics{figures/data-model.png}
\fi
\caption{PuffinPlot's hierarchical data model. Each layer (except the
lowest) contains multiple instances of the following layer.}
\end{figure}

PuffinPlot uses a hierarchical data structure, with higher levels
containing multiple instances of each lower level. The structure is
summarized in Figure 2. At the top is the \emph{suite}, which contains
all the data to be analysed as part of a particular study. For a
discrete specimen study, this will typically correspond to a section in
the field; for a long core study, it will correspond to a core. A suite
is initially created by opening one or more data files from a
magnetometer; it is saved as a file in PuffinPlot's own format. In a
discrete study, a suite contains multiple \emph{sites}. A site
corresponds to a set of samples taken from one spot in a section. A
site's associated data can include such things as bedding attitude and
stratigraphic height, as well as calculated parameters such as the mean
palaeomagnetic direction for all the samples at the site. For a long
core study, sites are not defined: samples are contained directly within
the suite.

Each site (or, for long core data, the suite) contains multiple
\emph{samples}. A sample corresponds to a small physical volume of rock.
For a discrete study, this will usually be a typical palaeomagnetic 25mm
cylinder or IODP cube sample. For long cores, it is the portion of the
core at a particular depth. The data associated with a sample consists
of information specific to this physical unit which does not change with
the application of demagnetization techniques --- for example, a sample
code or name (or, for long cores, a depth), the field orientation of the
sample, and its volume. For discrete samples this data can also include
a tensor representing anisotropy of magnetic susceptibility, which is
imported separately from an Agico kappabridge datafile and collated with
the magnetization data by matching the sample names. The sample can also
contain calculated parameters, such as a direction fitted by principal
component analysis, or a best-fitting great circle.

Each sample contains multiple \emph{demagnetization steps}. A
\emph{step} represents a sample at a particular point during the
treatment protocol. Its associated data thus includes details of the
treatment: the type (thermal, AF, IRM, etc.) and parameters
(temperature, field strength, etc.). The data also includes the state of
the sample itself --- most importantly, the measured magnetization
vector. For thermal studies, the magnetic susceptibility is usually also
recorded after every heating cycle, and is also stored as part of the
step.

\subsection{Main window features}

This section describes the parts and functions of the main PuffinPlot
window, as shown in figure~\ref{fig:screenshot}.

\subsubsection{Plot area}

The plot area is the largest part of the window, and plots the data for the
current sample using various plots. By default, four plots are shown: a
demagnetization-intensity biplot, a Zijderveld plot, an equal-area
projection, and a table of demagnetization steps. The plots can be moved and
resized (see section~\ref{sec:change-layout}). Other plots are also
available, and the preferences window can be used to control which plots are
displayed (see section~\ref{sec:preferences}).

\subsubsection{Sample chooser}

The sample chooser sits at the leftmost edge of the main window, and
allows you to change the current sample (the one for which data is
plotted) and the set of selected samples (most of PuffinPlot's functions
operate on the currently selected samples). Often, the set of selected
samples will consist only of the current sample.

The sample chooser takes two forms, depending on whether the current
suite of data is for discrete samples or for a continuous long core
measurement.

\paragraph{Using the discrete sample chooser}

The discrete sample chooser shows the names of the samples in the current
suite. The selected sample or samples are highlighted in a different colour.
If more than one sample is selected, the first of them is displayed in the
main plot area.

To select a single sample, click on its name. To select a contiguous range of
samples, click at one end of the range, then hold down \ppcmd{Shift} while
clicking at the other end of the range. To select multiple, non-contiguous
samples, hold down \ppcmd{Ctrl} while clicking. To select all samples, press
\ppcmd{Ctrl-A}.

\paragraph{Using the continuous sample chooser}

The continuous sample chooser is a vertical grey bar representing the total
length of the measured core, striped with horizontal white lines representing
the individual measurements at each depth. (If there are too many
measurements for all the requisite white lines to be displayed, they are
omitted.) A black triangle and line show the current depth. The selected
samples are denoted with orange highlighting.

To select a single depth, click on the appropriate part of the sample
chooser. To scroll rapidly through a range of samples, click and drag the
mouse along the sample chooser. To select a range of samples, hold down
\ppcmd{Shift}, then click, drag, and release the mouse on the chooser.

\paragraph{Keyboard shortcuts for sample selection}

Use \ppcmd{Ctrl-B} and \ppcmd{Ctrl-N} to change the current sample. Use
\ppcmd{Ctrl-A} to select all the samples in the current suite. You can also
use the up and down arrow keys to change the sample.

\subsubsection{\label{sec:toolbar}Toolbar}

The toolbar displays various data and provides several controls.
From left to right, these are:

\begin{description}

\item[Suite chooser.] This shows the name of the current suite of
data. If more than one suite of data has been opened, the suite chooser
allows you to switch between them.

\item[Orientation correction chooser.] This chooser allows you to
choose whether data is displayed in laboratory co-ordinates
(\ppcmd{uncorrected}), in field co-ordinates, corrected for sample orientation
(\ppcmd{samp. corr.}), or in tectonic co-ordinates, corrected for both
sample orientation and bedding orientation (\ppcmd{form. corr.}).

\item[Zijderveld projection type.] This chooser controls the vertical
projection used in the Zijderveld plot. The {\em y} axis always corresponds
to the vertical direction; the chooser controls the {\em x} axis, which may
correspond to North (\ppcmd{V vs. N}) or East (\ppcmd{V vs. E}). The third
option, \ppcmd{V vs. H}, projects each data point separately, in the plane
containing itself and the origin; this is sometimes referred to as a
`modified Zijderveld' plot.

\item[Sample orientation] (\ppcmd{Samp}). The first number is the
azimuth of the sample orientation; the second is its dip. For a long core,
all these values will usually be 0 and 90 respectively throughout the core.

\item[Formation orientation] (\ppcmd{Form}). The first number is the
dip direction of the bedding; the second in the dip magnitude.

\item[Magnetic declination] (\ppcmd{Dev}). This is the angle between
magnetic north and true north at the sampling site. (It is abbreviated
`Dev' (for `deviation') to avoid any possible confusion with the
declinations of sample magnetizations.

\item[Select all] selects all the points in the current sample.

\item[\caps{Pca}] performs principal component analysis for the
selected points of all the selected samples.

\item[Clear calculations] de-selects all the points in all the
selected samples, and clears the results of any calculations done on them,
such as \caps{pca} or great-circle analysis.

\end{description}

\section{Detailed usage}

This section gives a methodical account of PuffinPlot's features.

\subsection{Catalogue of functions}

This section lists all the items in PuffinPlot's menus, giving a brief
description of the functionality associated with each one.

\subsubsection{File menu}

This menu contains functions connected with opening, closing, and
saving files.

\begin{menuitemlist}

\item[File\submenu Open\ldots] loads one or more files of demagnetization
  data into PuffinPlot as a new suite. See
  section~\ref{sec:file-types} for details of supported filetypes.

\item[File\submenu Open recent file] is a submenu which
contains the names of the last eight files which have been opened in
PuffinPlot, allowing them to be opened again with a single click.

\item[File\submenu Save] saves the current suite as a PuffinPlot file. If
the suite was opened from a PuffinPlot file or if it has been previously
saved as a PuffinPlot file, it will immediately be saved to that file. If no
PuffinPlot file is associated with this suite yet, a standard ‘save file’
dialog box will prompt you for a file name and location.

\item[File\submenu Save as\ldots] allows you to save the current suite to a
different filename or location.

\item[File\submenu Close] closes the current suite, removing it from
PuffinPlot's data display.

\item[File\submenu Export data] is a submenu allowing the export of
various kinds of data to \caps{csv} files.

\item[File\submenu Export data\submenu Export sample calculations\ldots]
  saves a file containing all the data associated with individual samples.
  Table~\ref{tbl:export-sample} describes the fields which make up the file.

\begin{table}[tp]
%{Fields for sample data export}
  \caption{\label{tbl:export-sample} List of fields in exported sample data file, Note that, in addition to the predefined fields, any custom user annotations (see section~\ref{sec:annotations}) will also be exported in this file.}
\begin{tabular}{lp{100mm}} \toprule
Field name          & Description \\ \midrule
Suite                & Suite name \\
sample               & Sample name \\
\caps{nrm} intensity & \caps{Nrm} intensity (A/m) \\
\caps{ms} jump temp. & For thermal demagnetization, the
temperature step at which the first jump in magnetic susceptibility occurs, A
jump is defined as an increase of 2.5 or more times the previous value.
\\
Fisher inc.          & Mean inclination (\textdegree)\\
Fisher dec.          & Mean declination (\textdegree)\\
Fisher a95           & \alnifi{} of mean direction (\textdegree)\\
Fisher k             & $k$-value of mean direction \\
\caps{pca} inc.      & Inclination of \caps{pca} direction (\textdegree)\\
\caps{pca} dec.      & Declination of \caps{pca} direction (\textdegree)\\
\caps{pca} \caps{mad}1 &  The Maximum Angle of Deviation
for the planar \caps{pca} fit; the smaller the value, the more coplanar the points. \\
\caps{pca} \caps{mad}3 & The Maximum Angle of Deviation
for the linear \caps{pca} fit; the smaller the value, the more collinear the points. \\
\caps{pca} anchored    & `yes' if the
\caps{pca} fit was anchored; `no' if not \\
\caps{pca} start       & Field or temperature of
first demagnetization step used for \caps{pca} analysis (\textdegree C or mT)\\
\caps{pca} end         & Field or temperature of
last demagnetization step used for \caps{pca} analysis (\textdegree C or mT)\\
\caps{pca} contiguous       & `yes' if
all steps between the first and last were selected for \caps{pca};
`no' if any were omitted \\
\caps{mdf} half-intensity   & half of the \caps{nrm} \\
\caps{mdf} demagnetization  & the demagnetization level
at which the \caps{nrm} was reduced to half (\textdegree C or mT) \\
\caps{mdf} midpoint reached & `yes' if magnetization
intensity reached half the \caps{nrm} intensity during demagnetization;
`no' otherwise \\
{\em [annotations]}  & Any user-defined annotations
are also exported as part of the sample export file. See
section~\ref{sec:annotations} for details. \\ \bottomrule
\end{tabular}
\end{table}

\item[File\submenu Export data\submenu Export site calculations\ldots] saves
  a file containing (for suites with discrete samples) all the data
  associated with sites. Table~\ref{tbl:export-site} describes the fields
  which make up this file.

\begin{table}[tp]

  \caption{\label{tbl:export-site} List of fields in exported site data file}

\begin{tabular}{p{5em}p{\textwidth-5em}} \toprule
  Field name      & Description \\ \midrule
  site            & Name of site \\
  Fisher inc.     & Mean inclination of \caps{pca} directions (\textdegree) \\
  Fisher dec.     & Mean declination of \caps{pca} directions (\textdegree) \\
  Fisher a95      & \alnifi{} of mean \caps{pca} direction (\textdegree) \\
  Fisher k        & {\em k}-value of mean \caps{pca} direction \\
  \caps{gc} valid & `Y' if the great-circle fit
  is valid, blank otherwise. A fit is valid if it includes at least three
  circles, and has $\alpha_{95} < 3.5$ and $k>3$. \\
  \caps{gc} inc.  & Inclination of great-circle direction (\textdegree) \\
  \caps{gc} dec.  & Declination of great-circle direction (\textdegree) \\
  \caps{gc} a95   & \alnifi{} for great-circle direction (\textdegree) \\
  \caps{gc} k     & {\em k}-value for great-circle direction \\
  \caps{gc n}     & Number of great circles used in great-circle fit \\
  \caps{gc m}     & Number of \caps{pca} directions used in great-circle fit \\
  \caps{t}1min\newline \caps{t}1max\newline \caps{t}2min\newline \caps{t}2max
    & These four parameters give the ranges of demagnetization steps used to fit
    the circles. \caps{t}1 is the first (lowest) demagnetization step in a circle
    path for an individual sample, and \caps{t}2 the last (highest). \caps{t}1min
    is the minimum of the \caps{t}1 values across all the circles for the site,
    and \caps{t}2 the maximum. Similarly, \caps{t}2 is the last step used in a
    single circle, and \caps{t}2min--\caps{t}2max is the range of its values
    across all the samples at a site. \\ \bottomrule
\end{tabular}
\end{table}

\item[File\submenu Export data\submenu Export suite calculations\ldots] saves
  a \caps{csv} file containing only one line of data, which gives the mean
  inclination, mean declination, \alnifi{}, and {\em k} for the Fisherian
  mean direction calculated for the entire suite.

\item[File\submenu Export data\submenu Export IRM data\ldots] saves files
  containing \caps{irm} acquisition data. It produces a folder of files, one
  for each sample in the suite. Each file is in tab-delimited text format,
  and each line within the file contains the \caps{irm} field strength and
  the magnetization intensity of the sample after application of that field.

\item[File\submenu Page Setup\ldots] opens a window allowing you
to change the paper size, orientation, and margins for printing.

\item[File\submenu Print\ldots] opens a window allowing you to print the
selected samples. Note that {\em only} the selected samples will be printed,
so if you wish to print the whole suite use \ppcmd{Edit\submenu Select all} first.
On most systems this will also allow you to print to a \caps{pdf} file;
Windows users may need to install a virtual \caps{pdf} printer, such as
Cute\caps{pdf} Writer or Bullzip \caps{pdf} Printer, in order to produce
\caps{pdf} files.

\item[File\submenu Print Fisher\ldots] prints the contents of the separate
window showing Fisher statistics of \caps{pca} directions through the suite;
see \ppcmd{Calculations\submenu Fisher on suite} in
section~\ref{sec:functions-calcs} for more details.

\item[File\submenu Print Great Circles\ldots] prints the contents of the
  separate great-circle fit window; see \ppcmd{Calculations\submenu Great
    circles} in section~\ref{sec:functions-calcs} for more details.

\item[File\submenu Import AMS\ldots] imports \caps{ams} data from a file. The
  file must be in the \caps{.asc} format produced by the \ppcmd{Safyr}
  program distributed with \caps{Agico} kappabridges. The \caps{ams} data is
  assigned to the appropriate samples within the suite by matching the sample
  names specified in the \caps{asc} file with the sample names for the
  demagnetization data. If the \caps{ams} file contains data for samples not
  in the suite, these samples will be created and added to the suite.
  \caps{Ams} data is not displayed by default; the equal-area plot of
  \caps{ams} data can be activated from the \ppcmd{Preferences} window.

\item[File\submenu Export SVG] saves the current contents of the main
data display as an \caps{svg} (Scalable Vector Graphics) file. As a vector
graphics format, \caps{svg} is allows for high-quality reproduction at any
size. It can also be easily edited and incorporated into other graphics using
vector graphics programs such as Inkscape and Adobe Illustrator.

\item[File\submenu Export preferences\ldots] saves your current preferences to
a file. In conjunction with the \ppcmd{Import preferences} feature, this
allows you to transfer your preferences from one computer to another. It also
allows you to keep multiple sets of preferences and switch between them as
needed. Probably the most useful application is to save different plot
layouts for different sets of data.

\item[File\submenu Import preferences\ldots] sets your preferences from
a file saved using \ppcmd{Export preferences}. See the description of
\ppcmd{Export preferences} for details.

\item[File\submenu Preferences\ldots] opens the preferences window. See
section~\ref{sec:preferences} for details. On Mac OS X, this item is
found on the \ppcmd{PuffinPlot} menu to the left of the \ppcmd{File} menu,
rather than on the \ppcmd{File} menu.

\item[File\submenu Quit] terminates PuffinPlot. On Mac OS X, this item is
found on the \ppcmd{PuffinPlot} menu to the left of the \ppcmd{File} menu,
rather than on the \ppcmd{File} menu.

\end{menuitemlist}

%\FloatBarrier
\subsubsection{Edit menu}

The \ppcmd{Edit} menu provides various basic functions mainly
to do with manipulation of data points.

\begin{menuitemlist}

\item[Edit\submenu Select all] selects all the points in all the selected
samples, excluding points which have been hidden (see \ppcmd{Hide points}
below).

\item[Edit\submenu Clear selection] de-selects all the points in all
the selected samples.

\item[Edit\submenu Move plots] allows you to reposition and resize the plots
  in the main display area. See section~\ref{sec:move-plots} for
  details.

\item[Edit\submenu Reset layout] resets the sizes and positions of
all the plots to their default values.

\item[Edit\submenu Corrections\ldots] opens a window which allows you to
change the sample orientation, formation orientation, and local magnetic
declination for all the selected samples. Each correction type can be
individually changed without affecting the values of the others.

\item[Edit\submenu Copy point selection] takes the points which are selected
  for the current sample, and selects the corresponding points for all the
  selected samples. This is useful, for example, for hiding the same points
  in a large number of samples without having to manually select them for
  each sample.

\item[Edit\submenu Flip selected samples] is a submenu allowing the selected
  samples to be rotated 180\textdegree around a selected axis. Such
  functionality is rarely required but can be useful, for example, when it is
  found that a sample has been incorrectly oriented during measurement, or
  when converting between different orientation conventions.

\item[Edit\submenu Flip selected samples\submenu Flip samples around X axis]
  rotates the magnetic moment values for all selected samples 180\textdegree
  around the X axis.

\item[Edit\submenu Flip selected samples\submenu Flip samples around Y axis]
  rotates the magnetic moment values for all selected samples 180\textdegree
  around the Y axis.

\item[Edit\submenu Flip selected samples\submenu Flip samples around Z axis]
  rotates the magnetic moment values for all selected samples 180\textdegree
  around the Z axis.

\item[Edit\submenu Edit sites] is a submenu allowing site names to be
  set for samples in various ways.

\item[Edit\submenu Edit sites\submenu Set site name\ldots] allows a single
  site name to be set for all the selected samples.

\item[Edit\submenu Edit sites\submenu Set sites from sample names\ldots] sets
  site names for the selected samples by taking specified characters from the
  sample names. The characters to use are specified by a list of
  comma-separated numbers and number ranges; for example, entering
  \ppcmd{1,3,5-8} would give each selected sample a site name composed of the
  first, third, and fifth to eighth characters of the sample name, so that
  a sample with the name \ppcmd{FFQB0529.1} would get the site name
  \ppcmd{FQ0529}. The table below gives some further examples.

\begin{tabular}{lll} \toprule
Sample name & Character selection & Resulting site name \\ \midrule
FFQB0529.1 & 1,3,5-8 & FQ0529 \\
FFQB0529.1 & 4-6 & B05 \\
CiLpA-10-53 & 1-2,5,7-8 & CiA10 \\
CiLpA-10-53 & 3-4,9-11 & Lp-53 \\
\bottomrule \end{tabular}

\item[Edit\submenu Edit sites\submenu Set sites by depth\ldots] sets site
  names in continuous suites using the depths of the individual samples.
  PuffinPlot asks for a thickness value, and groups the samples within the
  core into sites of that thickness, effectively `slicing' the core into
  equally thick sites. Each site is named after the shallowest depth within
  it.

\item[Edit\submenu Hide points] hides all the selected points in all the
  selected samples. This removes them from all the graphical plots (which
  will be rescaled to avoid unnecessary blank space), but not from the data
  table in the main plot window; on the data table, hidden data points are
  marked with a dash symbol (--) to their left. Hidden points can be restored
  using the \ppcmd{Show all points} menu item.

\item[Edit\submenu Show all points] restores all hidden points in all the
  selected samples.

\item[Edit\submenu Edit custom flags\ldots] allows you to add or remove
  user-defined flags for the suite; see section~\ref{sec:annotations} for
  details.

\item[Edit\submenu Edit custom notes\ldots] allows you to add or remove
  user-defined note categories for the suite; see
  section~\ref{sec:annotations} for details.

\item[Edit\submenu Rescale mag. sus.\ldots] scales all the magnetic
  susceptibility values for the suite by a specified factor. This is useful
  since magnetic susceptibility meters typically do not report values in
  standard S.I. units. Note that, unlike many PuffinPlot operations, the
  scaling is applied to the {\em entire suite}, not just the selected
  samples.

\end{menuitemlist}

\subsubsection{\label{sec:functions-calcs}Calculations menu}

The calculations menu provides facilities for calculating magnetic
parameters and directions. Note that most calculations operate on
all the selected samples, not just the current sample.

\begin{menuitemlist}

\item[Calculations\submenu PCA] calculates a best-fitting line to all the
  selected points in all the selected samples, using principal component
  analysis \citep{kirschvink1980least}. The \caps{pca} direction is projected
  onto the Zijderveld plot.

\item[Calculations\submenu Anchor PCA] is a menu item which may be toggled on
  or off. When it is on, \caps{pca} analyses are constrained to pass through
  the origin. In general, the \caps{pca} should be anchored when the analysed
  points are known to represent the final demagnetization component. Leaving
  it unanchored allows analysis of secondary components, provided that they
  are sufficiently well separated from other components.

\item[Calculations\submenu Fisher by site] calculates a Fisherian mean
  direction for the \caps{pca} directions at each site.

\item[Calculations\submenu Fisher on suite] calculates a Fisherian mean of
  the \caps{pca} directions for all the selected samples, and opens a new
  window showing an equal-area plot of the \caps{pca} directions, the mean
  direction, and the 95\% confidence circle.

\item[Calculations\submenu MDF] calculates the Median Destructive Field (or,
  for thermal demagnetization, the Median Destructive Temperature) of the
  selected samples. This is the field (or temperature) at which the intensity
  of the sample's remanence has been reduced to half of its initial value.
  Once calculated, it is displayed on the demagnetization-intensity plot, and
  can be saved as part of the exported sample data.

\item[Calculations\submenu Clear calculations] de-selects all the points
in all the selected samples, and clears the results of any calculations done
on them, such as \caps{pca} or great-circle analysis.

\item[Calculations\submenu Fit circle] calculates and displays a
best-fitting great circle for all the selected points in all the selected
samples.

\item[Calculations\submenu Great circles] calculates a best-fitting
direction for all the great circles fitted at the current site,
using the algorithm of \cite{mcfadden1988circles}. The great-circle fit
is shown both in the \ppcmd{Great circles} plot in the main window
(if the plot has been activated in the preferences), and in
a separate window which is opened automatically.

\item[Calculations\submenu Clear site calculations] clears the
results of any calculations associated with the selected {\em sites}
(as opposed to samples); at present, this amounts to clearing the
best-fit great-circle direction for each selected site.

\item[Calculations\submenu Reversal test] performs a basic reversal
test on {\em all} the currently open suites.

\end{menuitemlist}

\paragraph{\caps{Ams} calculations}

PuffinPlot can show the results of statistical calculations on \caps{ams}
tensors, giving mean directions and confidence ellipses for the principal
axes by one of three methods; at present, however, these calculations cannot
be performed by PuffinPlot itself. Instead, it makes use of two Python
scripts from the PmagPy suite \citep{tauxe2010paleomagnetism},
\ppcmd{bootams.py} and \ppcmd{s\_hext.py}. In order to calculate \caps{ams}
statistics, these scripts must first be installed on the computer running
PuffinPlot, and the folder containing them must be specified in the
\ppcmd{Preferences} window. The PmagPy programs may be obtained from
\url{http://earthref.org/PMagPy/}.

All \caps{ams} calculations operate on the currently selected samples.
\cite{tauxe1998directions} and chapter 13 of \cite{tauxe2010paleomagnetism}
give more details of tensor statistics, particularly with regard to the
application of bootstrap methods.

\begin{menuitemlist}

\item[Calculations\submenu Calculate bootstrap \caps{ams}] calculates
bootstrap statistics using the \ppcmd{bootams.py} program, producing
Kent error ellipses which are shown on the \caps{ams} plot in the main
window.

\item[Calculations\submenu Parametric bootstrap \caps{ams}] calculates
bootstrap statistics using the \ppcmd{bootams.py} program, producing Kent
error ellipses which are shown on the \caps{ams} plot. It differs from the
previous function in employing a parametric bootstrap, which can provide more
realistic confidence intervals for small numbers of samples on the (often
reasonable) assumption that measurement uncertainties are normally
distributed across the selected samples.

\item[Calculations\submenu Calculate Hext on \caps{ams}] calculates
\cite{hext1963tensors} statistics using the \ppcmd{s\_hext.py} program
and displays the mean directions and error ellipses on the \caps{ams} plot.

\item[Calculations\submenu Clear \caps{ams} calculations] Clears
any previously done bootstrap and Hext calculations.

\end{menuitemlist}

\subsubsection{Window menu}

This menu allows you to open or close two windows displaying extra data.

\begin{menuitemlist}

\item[Window\submenu Data table] opens (or closes) a window showing
all the demagnetization data for the current sample as a table. This
table is far more extensive than the brief table displayed in the
main window, and allows data to be selected and copied to the clipboard
so that it can be pasted into a spreadsheet or text editor.

\item[Window\submenu Suite \caps{pca} plot] opens (or closes) a window
containing an equal-area plot of \caps{pca} directions; the plot is created
by selecting the \ppcmd{Calculations\submenu Fisher on suite} menu item,
and may be printed using the \ppcmd{File\submenu Print Fisher\ldots} menu item.

\end{menuitemlist}

\subsubsection{Help menu}

\begin{menuitemlist}

\item[Help\submenu About PuffinPlot] displays some brief information
about PuffinPlot, including the version. On Mac OS X, this item is
also present on the \ppcmd{PuffinPlot} menu.

\end{menuitemlist}

\subsection{Features}

This section presents PuffinPlot's features in moderate detail.

\subsubsection{\label{sec:file-types}Supported file types}

PuffinPlot can currently open three types of file: its own filetype (filename
suffix \ppcmd{ppl}); data produced from 2\caps{g} cryomagnetometers (filename
suffix \ppcmd{dat}); and data from the {\ss Zplot} program by Stephen Hurst
(filename suffix \ppcmd{txt}). In general, support for other file formats is
straighforward to add.

\subsubsection{Selecting points}

For most of PuffinPlot's functions, the data points of interest must be
selected before anything can be done to them. You can select data points
simply by clicking on them; if you click on a selected point it will be
de-selected. Selected points are drawn in red to distinguish them from the
black unselected points. Note that the notional data point itself is the
thing being selected, not the visual representation that you click on. Thus,
if you click on a point in one plot, the corresponding point in all the
visible plots will also turn red, since they are visual representations of
the same datum.

Since data points are relatively small, clicking accurately on them can be
inconvenient. PuffinPlot offers two alternative selection methods to
alleviate this problem. Firstly, by holding down the \ppcmd{Shift} key, you
can select a point simply by left-clicking near it; holding \ppcmd{Shift} and
right-clicking will de-select nearby points instead. Secondly, you can click,
hold the button, and drag the pointer across the graph, creating a rectangle.
Any point within the rectangle will be selected.

\subsubsection{Working with multiple samples}

Since most PuffinPlot operations are automatically applied to all the
selected samples, repetitive analysis work can often be done automatically
using the \ppcmd{Copy point selection} feature. For example, if you wish to
apply a \caps{pca} to the 100--250\textdegree{}C demagnetization range of a
series of 50 samples, it can be done in four quick steps:

\begin{enumerate}

\item For the first sample, select the points corresponding to the
  100--250\textdegree{}C demagnetization range.

\item Select the 50 samples using the sample chooser, keeping the
  first sample as the current one.

\item Use \ppcmd{Copy point selection} on the \ppcmd{Edit} menu
  (or press \ppcmd{Ctrl-Shift-C} to select the corresponding points
  in all the selected samples.

\item Select \ppcmd{\caps{pca}} from the \ppcmd{Calculations} menu,
  or press \ppcmd{Ctrl-R}.

\end{enumerate}

This will immediately perform \caps{pca} on all 50 selected samples.

\subsection{\label{sec:plot-types}Plot types}

This section lists and briefly describes the available plot types in
PuffinPlot. Some of them are not displayed by default, but these may be
activated via the preferences window (see
section~\ref{sec:preferences}). Note that the term `plot' is used
rather loosely in this manual to refer to any movable element displaying data
within the main window. Thus, the `plots' listed below include textual
elements such as legends.

\begin{menuitemlist}

\item[Equal-area] is a Lambert azimuthal equal-area projection showing
the directions of the current sample's magnetization vectors. Successive
points are connected by great-circle segments. Points in the upper hemisphere
are shown as unfilled (white) and connected by solid lines; points in the
lower hemisphere are filled (black) and connected by dashed lines. If a great
circle fit has been calculated for the sample, it is shown on this plot.

\item[Zplot] is a Zijderveld plot, overlaying an orthographic projection in
  the horizontal plane with an orthographic projection in a chosen vertical
  plane. The vertical plane can be controlled using the chooser on the
  toolbar; see section\ref{sec:toolbar} for details. The horizontal
  projection is shown with filled points, and the vertical projection with
  unfilled points. If a \caps{pca} fit has been calculated for this sample,
  the two projections of the \caps{pca} lines are overlaid on the plot in
  blue. (If the \ppcmd{V vs. H} vertical projection is selected, only the
  horizontal projection of the \caps{pca} line is shown, since \ppcmd{V vs.
    H} effectively uses a different vertical projection for each point.)

\item[Zplot key] is a legend for the Zijderveld plot, showing
the interpretations of the filled and unfilled points and giving the
units in which the axes are calibrated.

\item[Demag.] is a plot of demagnetization step (in mT or °C) versus
intensity of magnetization (in A/m), shown as a line of filled points.
If magnetic susceptibility measurements have been taken, they are
overlaid on the same plot as unfilled points, with the scale shown on the
right of the graph.

\item[Data table] is a table in which each row represents one
demagnetization step for the current sample. The columns, from left
to right, give the demagnetization step, declination, inclination,
intensity, and magnetic susceptibility. Selected points are denoted
by an asterisk (*) to their left; hidden points are denoted by a
dash (--) to their left.

\item[\caps{Pca}] shows the results of \caps{pca} textually, if
\caps{pca} has been carried out for the current sample; otherwise it is
invisible. When visible, it shows the inclination and declination of the
first principal component, which corresponds to a least-squares linear
fit. It also shows the maximum angular deviation (\caps{mad}) values
\caps{mad}1 and \caps{mad}3, which function as goodness-of-fit parameters
(smaller is better) for planarity and collinearity respectively.
\cite{kirschvink1980least} gives more detail of the interpretation
of \caps{mad} values.

\item[Title] simply shows the name of the current sample and
the current site, for a discrete suite. For a continuous (long core)
suite, it shows the current depth.

\item[Fisher] shows the parameters of the per-sample Fisherian analysis, if
  one has been carried out; otherwise it is invisible. It gives the mean
  inclination and declination and the \alnifi{} and $k$ parameters.

\item[\caps{Ams}] is a lower-hemisphere equal-area plot of
\caps{ams} data, if any has been imported. Maximum, intermediate, and
minimum anisotropy axes are shown as squares, triangles, and circles
respectively. If \caps{ams} statistics have been calculated (see
section~\ref{sec:functions-calcs}), the mean directions and
confidence ellipses are also shown.

\item[Ternary demag.] is an experimental ternary plot designed
to display data from triaxial \caps{irm} demagnetization experiments
conducted according to the method of \cite{lowrie1990identification}.
The position of a point on the plot reflects the relative strengths
of the three axes of magnetization, which in turn correspond to
high, medium, and low coercivity components. The path produced
by points at successive demagnetization steps thus shows the relative
effects of thermal unblocking and alteration on these components.

\item[Great circles] shows all the great circles fitted at
the current sample's site, along with a best-fit direction calculated
by the method of \cite{mcfadden1988circles}.

\item[Formation mean] shows all the site means for the suite,
and a Fisherian mean and 95\% confidence interval for them.
If two polarities are present in the suite, two means are calculated
and shown.

\item[\caps{Nrm} Histogram] shows a histogram of \caps{nrm}
intensities across the whole suite.

\end{menuitemlist}

\subsubsection{\label{sec:move-plots}Arranging the plots}

PuffinPlot allows the plots to be freely rearranged and resized within the
display area; they can also be switched on and off as required (see
section\ref{sec:preferences}). To arrange the plots, select
\ppcmd{Move plots} from the \ppcmd{Edit} menu. A tick appears next to the
menu item, and the plots are overlaid by pale orange rectangles, allowing you
to manipulate them. Each plot is also annotated with its name, which helps to
identify plots that are not currently displaying any data (e.g. the
`\caps{pca} directions' display if no \caps{pca} has been performed. To
resize a plot, click on an edge or corner of its rectangle and drag it to the
desired size. To move a plot, click in its central area and drag it to the
desired location. Plots may be overlapped freely. When manipulating
overlapping plots, mouse clicks only affect the smallest plot in the `pile'.

Once the plots are arranged to your satisfaction, click \ppcmd{Move plots} on
the \ppcmd{Edit} menu again to untick the menu item and resume normal
operation.

\subsubsection{\label{sec:change-layout}Changing the layout}

You can change the size and arrangement of the plots in the main window by
choosing \ppcmd{Move plots} from the \ppcmd{Edit} menu. This puts PuffinPlot
temporarily into a special mode where plots become moveable: a tick appears
next to the \ppcmd{Move plots} menu item, and the plots themselves are
overlaid by translucent coloured rectangles. The name of the plot is also
displayed at the top left corner of each rectangle; this can be useful for
identifying plots which are currently invisible -- for example, the table of
\caps{pca} values if no \caps{pca} has been performed.

In \ppcmd{Move plots} mode, you can resize a plot by clicking and dragging on
one of the darker-coloured edges or corners of the plot. You can move the
whole plot by clicking and dragging in its more lightly coloured central
zone. Plots can overlap one another freely. When you click in an area where
two or more plots overlap, the smallest plot is treated as the `topmost', and
this is the one which will be moved or resized.

\subsubsection{\label{sec:preferences}The preferences window}

The preferences window is divided into three tabs.

\paragraph{The \ppcmd{Loading} tab}

This tab contains options connected with reading data from \caps{.dat} files
produced by the \caps{2g} `Long Core' software.

\begin{menuitemlist}

\item[\caps{Squid} sensor lengths.] When reading a \caps{2g} file, PuffinPlot
  uses the `X corr', `Y corr', and `Z corr' fields to determine the
  magnetization vector. However, for long core measurements, these values are
  not corrected for effective sensor length, which is determined by the
  response function of each \caps{squid} and must be determined empirically
  when setting up the machine. To produce an accurate magnetization vector
  for long core files, PuffinPlot corrects the \caps{squid} readings for the
  configured sensor lengths when opening the file.

\item[Protocol] gives the measurement protocol used in taking the readings. A
  protocol is a particular sequence of empty tray measurements and sample
  measurements in defined orientations, undertaken for each set of measured
  samples. The tray and sample measurements are combined by PuffinPlot as it
  reads the file, providing a more accurate, corrected moment measurement for
  each sample. (Magnetic susceptibility measurements, if present, are also
  automatically associated with the preceding magnetic moment measurement or
  measurements.) Table~\ref{tbl:import-protocols} describes the
  available protocols.

\end{menuitemlist}

\begin{table}
  \caption{\label{tbl:import-protocols}Measurement protocols for 2\caps{g} data files}

\begin{tabular}{lp{90mm}} \toprule
Protocol & Description \\ \midrule
\caps{normal} &
 No extra tray or sample measurements are made. Each measurement run
 consists simply of measuring the samples once in their normal
 orientation. \\
\caps{tray\_normal} &
 Before each sample-measurement run, an empty tray measurement run
 is made. The input file thus consists alternately of empty-tray
 lines and sample-measurement lines. Each tray measurement is used
 to correct the subsequent sample measurement.
 \\
\caps{normal\_tray} &
 As \caps{tray\_normal}, but the tray measurement is made after
 the sample measurement rather than before it.\\
\caps{tray\_normal\_yflip} &
 As \caps{tray\_normal}, but adding an extra sample measurement as
 a third step. In the extra measurement, the sample is rotated
180\textdegree{} around its {\em y} axis, so that the {\em x} and {\em z}
measurements are inverted. Combining these readings improves not only the
precision but also the accuracy of the magnetic moments measured on the {\em
  x} and {\em z} axes, since any systematic bias should be cancelled out by
the inversion. For the {\em y} axis, accuracy is not affected but
precision is improved by averaging the two measurements. \\
\caps{tray\_first} &
 This is the simplest tray correction: the tray is measured once at the
start, and all subseuent measurements are sample measurements. PuffinPlot
corrects each sample measurement using the initial tray measurement.
\\
\caps{tray\_normal\_ignore} &
This option reads a file measured using the \caps{tray\_normal} protocol, but
(like \caps{tray\_first}) makes all sample corrections using the initial tray
measurement, and ignores all subsequent tray measurements. The main intended
use for this option is to allow direct comparison between the
\caps{tray\_first} and \caps{tray\_normal} protocols, to avoid the extra
work of using the \caps{tray\_normal} protocol on sample suites for which it
is unnecessary. \\ \bottomrule
\end{tabular}
\end{table}

\paragraph{The \ppcmd{Plots} tab}

This tab shows a list of plots which PuffinPlot can display. You can control
which plots are shown by ticking the boxes next to the plot names. The plot
types are detailed in section~\ref{sec:plot-types}.

\paragraph{The \ppcmd{Misc.} tab}

\begin{menuitemlist}

\item[Demag y axis] allows to you customize the text which labels the {\em y}
  axis of the demagnetization-intensity plot.

\item[PmagPy folder] sets the location of the PmagPy programs. If you wish to
  do calculations of \caps{ams} statistics within PuffinPlot, it is necessary
  to have the PmagPy programs \ppcmd{bootams.py} and \ppcmd{s\_hext.py}
  installed (see section~\ref{sec:functions-calcs} for details). This
  box allows you to specify to PuffinPlot the folder in which the programs
  are installed.

\item[Font] allows you to change the font used in the plots: enter a font
  family name into the box. PuffinPlot must be restarted for the change to
  take effect. If the specified font cannot be found, a default fallback font
  is used.

\end{menuitemlist}

\subsubsection{\label{sec:annotations}Annotations}

Annotations are a feature allowing short, categorized notes to be added to
each sample in a suite. The categories can be freely chosen. Annotations come
in two varieties, {\em custom flags} and {\em custom notes}. Custom flags
embody a true/false value and are intended to record whether a sample fulfils
some criterion -- for example, \quot{messy}, \quot{low-temperature
  alteration}, or \quot{multiple components}. Custom notes are intended for
adding short items of information which are not automatically inferred by
PuffinPlot -- for example, \quot{number of components} or \quot{behaviour
  type}.

\paragraph{Adding annotation categories}

Annotations categories defined by selecting the \ppcmd{Edit custom
  flags\ldots} or \ppcmd{Edit custom notes\ldots} item from the \ppcmd{Edit}
menu. This will show a window allowing you to add, rearrange, or remove the
annotation categories. If an annotation category is removed, all annotations
made within that category will be lost.

\paragraph{Using annotations}

When custom flags or notes have been defined, an extra panel appears at the
right-hand side of the main window. For each custom note category there is a
text box into which text may be typed. For each custom flag category there is
a tick box which may be selected or de-selected.

Annotations are saved with the rest of the data in the PuffinPlot file; they
are also exported in the sample data \caps{csv} file produced by the
\ppcmd{File\submenu Export data\submenu Export sample calculations} menu
item.

\subsubsection{\label{sec:scripting}Scripting}

PuffinPlot's graphical desktop interface is intended to be the primary way to
interact with the program. However, it is often useful to be able to control
a program using a scripting language, in order to extend its capabilities,
integrate it conveniently with other programs, or process large amounts of
data without manual intervention. The Java platform upon which PuffinPlot is
built supports a number of scripting languages which can easily interface
with PuffinPlot. Perhaps most usefully, an implementation of the Python
programming language -- named Jython \citep{juneau2009jython} -- has been
developed for the Java platform. Since Python is widely used in scientific
programming and scripting, and familiar to a large number of scientists, this
should provide a convenient route for anyone wishing to integrate PuffinPlot
with other data processing steps. Using Jython, PuffinPlot can be controlled
either from a pre-written script, or interactively from a command shell which
accepts and executes commands one at a time from the user.

Currently, the main barrier to controlling PuffinPlot from another program or
from an interactive shell is that its internal structure is very poorly
documented; for many parts, the source code itself constitutes the only
documentation. However, the source code is cleanly written and clearly laid
out, so careful perusal of it should provide enough understanding to
interface with most of PuffinPlot's facilities.

Figure~\ref{fig:script-example} shows a very simple script
demonstrating the use of PuffinPlot from within a Python environment. The
script opens a data file, calculates the mean \caps{nrm}, and produces a file
containing a \caps{pca} direction for each sample. Note that virtually all of
PuffinPlot's data and functionality is available to the Python script, so far
more complex examples are possible.

\begin{figure}
% {A simple script which uses PuffinPlot}
  \caption{\label{fig:script-example}A simple Python script to
    demonstrate the use of PuffinPlot from a scripting environment. This
    script first opens a data file. It then calculates the mean \caps{nrm} of
    all the samples and displays it. Then it calculates a \caps{pca}
    direction for each sample in the suite, and saves the results to a
    \caps{csv} file. Explanatory comments in the script are preceded by the
    character \#.}
\lstset{language=Python}
\begin{lstlisting}
### Import the required libraries.
from net.talvi.puffinplot import PuffinApp
from net.talvi.puffinplot.data import Suite
from java.io import File

### Start PuffinPlot and open a data file.
puffin = PuffinApp()
input_file = File("example.ppl")
suite = Suite([input_file])
samples = suite.getSamples()

### Calculate and display the mean NRM.
total_nrm = sum([sample.getNRM() for sample in samples])
print total_nrm / suite.getNumSamples()

### Perform a PCA calculation for each sample.
for sample in samples:          # do this for each sample:
    sample.selectAll()          # select all points in the sample
    sample.useSelectionForPca() # and mark them for use in PCA
suite.doSampleCalculations()    # perform PCA for each sample

### Save the results of the PCA calculation.
output_file = File("example-results.csv")
suite.saveCalcsSample(output_file)
\end{lstlisting}
\end{figure}

\newpage
\bibliographystyle{plainnat}
\bibliography{manual}

\end{document}
