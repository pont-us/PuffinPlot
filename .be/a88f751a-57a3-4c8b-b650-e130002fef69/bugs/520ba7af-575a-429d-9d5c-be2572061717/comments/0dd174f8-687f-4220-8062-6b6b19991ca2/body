Mostly implemented, remaining bits opened as more specific new bugs.
